---
title: "LLE"
author: "Rubén A. Rodríguez Barrón"
date: "4/26/2021"
output: pdf_document
---
```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, error = FALSE)
```

```{r setup}
set.seed(1234)
library(tidyverse)
library(psych)
library(lle)
library(parallel)
library(ggrepel)
library(skimr)
library(tictoc)
library(patchwork)
library(corrr)
library(ggpubr)
```

```{r}
# Import clean
clean <- readRDS("clean.rds")
```

```{r}
# Remove rows w/ missing values
clean_no_missing <- na.omit(clean)

# Select only non-FT, numeric columns
only_ft <- clean_no_missing %>%
  dplyr::select(starts_with(c("ft_"))) %>%
  scale() %>%
  as_tibble()

# Collapse Party/Ideology into broader groups
clean_no_missing <- clean_no_missing %>% mutate(
  ideology2 = fct_collapse(
  ideology,
  Liberal=c("Extremely Liberal", "Liberal", "Slightly Liberal"),
  Conservative=c("Extremely Conservative", "Conservative", "Slightly Conservative"))) %>%
  mutate(
  party2=fct_collapse(
  party,
  Democrat=c("Strong Democrat", "Democrat", "Lean Democrat"),
  Republican=c("Strong Republican", "Republican", "Lean Republican")))

summary(only_ft)
```

```{r}
# Optimal K for only the feeling thermometers
cores <- detectCores() - 1
cores
  
tic() 
find_k <- calc_k(only_ft,
                 m = 2, 
                 kmin=1,
                 kmax=200, # not sure what an appropriate upper bound is for 4k+ obs
                 parallel = TRUE,
                 cpus = cores) 
toc() # Approximately 
```

```{r}
## Confirming via which.min()
find_k[which.min(find_k$rho), ] 
```

```{r}
# Saving optimal k as a variable
opt_k <- find_k[which.min(find_k$rho), ][[1]]
```

```{r}
lle_fit <- lle(only_ft,
               m = 2,
               k = opt_k)
```

```{r}
clean_no_missing %>%
  ggplot(aes(x = lle_fit$Y[,1], 
             y = lle_fit$Y[,2], 
             col = as.factor(radio_no_radio) )) +
  geom_point(alpha=0.6) +
  stat_ellipse() +
  labs(x = "First Dimension",
       y = "Second Dimension",
       title = "LLE k = 96",
       col="radio_no_radio") + 
  theme_minimal()
```

